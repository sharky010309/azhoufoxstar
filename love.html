<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>æˆ‘ä»¬çš„æƒ…ä¹¦ Â· ğŸ’Œ</title>
<style>
  body { font-family: Arial, sans-serif; background:#ffe3ee; margin:0; }
  header { text-align:center; padding:28px 14px 8px; }
  h1 { margin:0; font-size:28px; color:#8b2e4b; }
  .sub { color:#a66a7c; margin-top:6px; }

  .panel, .ach-section, .love-col {
    background:#fff0f5; border:1px solid #ffb6c8; border-radius:14px; padding:14px; margin:20px; box-shadow:0 4px 12px rgba(0,0,0,.08);
  }
  .panel h2, .ach-head h2, .love-head h2 {
    font-size:20px; font-weight:bold; color:#8b2e4b; display:flex; align-items:center; gap:6px; margin:0 0 8px 0;
  }

  /* Hot tags */
  .hot-tags-title { font-size:14px; color:#8b2e4b; margin:10px 0 6px; display:flex; align-items:center; gap:4px; }
  .hot-tags { display:flex; gap:8px; flex-wrap:wrap; }
  .tag-btn { font-size:12px; padding:4px 8px; border-radius:999px; background:#fff0f5; border:1px solid #ffb6c8; color:#8b2e4b; cursor:pointer; animation:heartbeat 2.5s infinite; }
  .tag-btn:hover { background:#ffdae9; }
  @keyframes heartbeat {
    0%, 100% { transform:scale(1); }
    50% { transform:scale(1.1); }
  }

  /* Achievements */
  .ach-head { display:flex; align-items:center; justify-content:space-between; cursor:pointer; }
  .ach-body { margin-top:12px; }
  .ach-row { margin-bottom:20px; }
  .ach-row-title { font-weight:bold; margin-bottom:6px; color:#8b2e4b; }
  .badges { display:flex; gap:10px; margin-bottom:8px; }
  .badge { width:40px; height:40px; border-radius:50%; display:flex; align-items:center; justify-content:center; font-size:20px; opacity:.4; background:#fff; border:2px solid #ffb6c8; position:relative; }
  .badge.on { opacity:1; background:#ffe3ee; box-shadow:0 0 6px rgba(255,126,160,.6); }
  .badge:hover::after { content:attr(data-title) '\A' attr(data-desc); white-space:pre; position:absolute; top:-60px; left:0; background:#fff; border:1px solid #ffb6c8; padding:6px 10px; border-radius:8px; font-size:12px; color:#5a2b3a; }
  .progress-wrap { background:#ffe3ee; border-radius:999px; overflow:hidden; height:18px; margin-top:4px; }
  .progress-bar { height:100%; text-align:center; font-size:12px; color:#fff; white-space:nowrap; }
  .ach-stat { margin-top:4px; font-size:13px; color:#a14a65; }
  .toggle-arrow { transition:transform .3s; }
  .collapsed .toggle-arrow { transform:rotate(-90deg); }
  .collapsed .ach-body { display:none; }

  /* Galaxy progress bar */
  .galaxy-bar { background:linear-gradient(90deg,#d28eff,#ff9fbe,#ff87ad); position:relative; }
  .galaxy-bar::after { content:''; position:absolute; top:0; left:0; right:0; bottom:0;
    background-image:radial-gradient(2px 2px at 10% 20%, rgba(255,255,255,.8), transparent),
                      radial-gradient(2px 2px at 30% 80%, rgba(255,255,255,.6), transparent),
                      radial-gradient(2px 2px at 70% 50%, rgba(255,255,255,.7), transparent);
    background-repeat:repeat; animation:twinkle 2s infinite alternate; }
  @keyframes twinkle { from{opacity:0.2} to{opacity:1} }

  /* Love letters side by side */
  .love-wrap { display:flex; gap:20px; margin:20px; }
  .love-col { flex:1; display:flex; flex-direction:column; }
  .love-head { display:flex; align-items:center; justify-content:space-between; margin-bottom:8px; }
  .love-btn { background:#ff87ad; border:none; color:#fff; border-radius:8px; padding:6px 10px; cursor:pointer; }
  iframe { flex:1; border:0; border-radius:10px; background:#fff; min-height:500px; }

  /* Floating buttons */
  .fab { position:fixed; right:16px; bottom:16px; display:flex; flex-direction:column; gap:8px; }
  .fab button { background:#ff87ad; border:none; color:#fff; border-radius:20px; padding:8px 12px; cursor:pointer; }
</style>
</head>
<body>
  <header>
    <h1>æˆ‘ä»¬çš„æƒ…ä¹¦ Â· ğŸ’Œ</h1>
    <div class="sub">ç²‰ç²‰çš„æ˜Ÿæ²³é‡Œï¼Œä¸¤å°ä¸“å±çš„ä¿¡ç®±æ°¸è¿œä¸ºä½ å¼€ç€ã€‚</div>
  </header>

  <!-- æˆå°±åŒº (ä¿æŒä¸Šæ¬¡ç‰ˆæœ¬, å«æ€»æˆå°±) -->
  <div class="ach-section" id="achSection">
    <div class="ach-head" onclick="document.getElementById('achSection').classList.toggle('collapsed')">
      <h2>ğŸ† é˜¿æ˜¼å’Œå°ç‹ç‹¸çˆ±çš„æˆå°±</h2>
      <span class="toggle-arrow">â–¼</span>
    </div>
    <div class="ach-body">
      <div class="ach-row" id="rowT">
        <div class="ach-row-title">æˆ‘ä»¬çš„ä¸€èµ·</div>
        <div class="badges">
          <div class="badge" id="t50" data-title="ğŸ’ åŒå¿ƒåŒé¢‘" data-desc="ç¬¬ä¸€æ¬¡æ˜æ˜¾çš„åˆå¥æ„Ÿ">ğŸ’</div>
          <div class="badge" id="t100" data-title="ğŸŒŒ æˆ‘ä»¬çš„æ˜Ÿæ²³" data-desc="æŠŠæ–‡å­—å †æˆä¸€ç‰‡é“¶æ²³">ğŸŒŒ</div>
          <div class="badge" id="t200" data-title="ğŸ”¥ ç‚½çƒˆèª“è¨€" data-desc="å†å¤šä¹Ÿå†™ä¸å®Œçš„æ‰§å¿µ">ğŸ”¥</div>
          <div class="badge" id="t500" data-title="â™¾ï¸ æ°¸æ’ä¹‹çº¦" data-desc="åªå±äºæˆ‘ä»¬ä¿©çš„æ— å°½ä¹¦ä¿¡">â™¾ï¸</div>
        </div>
        <div class="progress-wrap"><div class="progress-bar galaxy-bar" id="progT">0%</div></div>
        <div class="ach-stat" id="statT">æˆ‘ä»¬è¿˜æ²¡å¼€å§‹å†™å‘¢</div>
      </div>

      <div class="ach-row" id="rowA">
        <div class="ach-row-title">é˜¿æ˜¼ â†’ å°ç‹ç‹¸</div>
        <div class="badges">
          <div class="badge" id="a10">ğŸŒ¸</div>
          <div class="badge" id="a30">ğŸŒ™</div>
          <div class="badge" id="a50">ğŸ”¥</div>
          <div class="badge" id="a100">ğŸ‘‘</div>
        </div>
        <div class="progress-wrap"><div class="progress-bar" id="progA">0%</div></div>
        <div class="ach-stat" id="statA">è¿˜æ²¡æœ‰å¼€å§‹å‘¢</div>
      </div>

      <div class="ach-row" id="rowF">
        <div class="ach-row-title">å°ç‹ç‹¸ â†’ é˜¿æ˜¼</div>
        <div class="badges">
          <div class="badge" id="f10">ğŸ’–</div>
          <div class="badge" id="f30">ğŸ°</div>
          <div class="badge" id="f50">ğŸ¦Š</div>
          <div class="badge" id="f100">â­</div>
        </div>
        <div class="progress-wrap"><div class="progress-bar" id="progF">0%</div></div>
        <div class="ach-stat" id="statF">è¿˜æ²¡æœ‰å¼€å§‹å‘¢</div>
      </div>
    </div>
  </div>

  <!-- çƒ­è¯åŒº -->
  <div class="panel">
    <h2>ğŸ’– å…³é”®çƒ­è¯</h2>
    <div id="cloud"></div>
    <div style="margin-top:8px; display:flex; gap:6px; align-items:center;">
      <input id="kwSearch" type="text" placeholder="è¾“å…¥å…³é”®è¯æœç´¢æƒ…ä¹¦â€¦" style="flex:1; padding:6px 8px; border:1px solid #ffb6c8; border-radius:8px; font-size:13px;">
      <button id="kwBtn">ğŸ”</button>
    </div>
    <div class="hot-tags-title">ğŸ’– æœ€çƒ­çš„å°å¿ƒå¿ƒ</div>
    <div class="hot-tags" id="hotTags"></div>
    <div id="kwResults" class="note" style="margin-top:8px;"></div>
  </div>

  <!-- æƒ…ä¹¦åŒºå·¦å³å¸ƒå±€ -->
  <div class="love-wrap">
    <div class="love-col" id="secA">
      <div class="love-head">
        <h2>ğŸº é˜¿æ˜¼ â†’ å°ç‹ç‹¸</h2>
        <button class="love-btn">å»å†™ä¸€å°</button>
      </div>
      <p class="note">æç¤ºï¼šé¦–æ¬¡ä½¿ç”¨éœ€è¦ GitHub ç™»å½•æˆæƒï¼›ä¹‹åè·¨è®¾å¤‡å¯è§ã€‚</p>
      <iframe src="board-azhou.html?v=1757254389"></iframe>
    </div>
    <div class="love-col" id="secF">
      <div class="love-head">
        <h2>ğŸ¦Š å°ç‹ç‹¸ â†’ é˜¿æ˜¼</h2>
        <button class="love-btn">å»å†™ä¸€å°</button>
      </div>
      <p class="note">æç¤ºï¼šé¦–æ¬¡ä½¿ç”¨éœ€è¦ GitHub ç™»å½•æˆæƒï¼›ä¹‹åè·¨è®¾å¤‡å¯è§ã€‚</p>
      <iframe src="board-fox.html?v=1757254390"></iframe>
    </div>
  </div>

  <!-- æµ®åŠ¨æŒ‰é’® -->
  <div class="fab">
    <button onclick="document.getElementById('secA').scrollIntoView({behavior:'smooth'})">â†‘ ğŸº é˜¿æ˜¼ â†’ å°ç‹ç‹¸</button>
    <button onclick="document.getElementById('secF').scrollIntoView({behavior:'smooth'})">â†“ ğŸ¦Š å°ç‹ç‹¸ â†’ é˜¿æ˜¼</button>
  </div>

<script>
  const REPO = 'sharky010309/azhoufoxstar-comments';
  const ISSUE_A = 1;
  const ISSUE_F = 2;

  async function loadCounts(){
    async function count(issue) {
      try {
        const r = await fetch(`https://api.github.com/repos/${REPO}/issues/${issue}`);
        const j = await r.json();
        return (j.comments||0)+1;
      }catch(e){return 0;}
    }
    const cA = await count(ISSUE_A);
    const cF = await count(ISSUE_F);
    updateAch('A', cA);
    updateAch('F', cF);
    updateTotal(cA+cF);
    updateHotTags();
  }

  function updateAch(who, n){
    const ids = who==='A'? ['a10','a30','a50','a100'] : ['f10','f30','f50','f100'];
    const goals = [10,30,50,100];
    goals.forEach((g,i)=>{
      const b=document.getElementById(ids[i]);
      if(n>=g) b.classList.add('on'); else b.classList.remove('on');
    });
    const nextGoal = goals.find(g=> n<g);
    const pct = nextGoal? Math.min(100, (n/nextGoal)*100):100;
    const prog = document.getElementById('prog'+who);
    prog.style.width = pct+'%';
    prog.textContent = n+' å°';
    const stat = document.getElementById('stat'+who);
    if(nextGoal) stat.textContent = 'å†™äº† '+n+' å°å°å¿ƒå¿ƒå•¦ï¼Œå†æ¥ '+(nextGoal-n)+' å°å°±èƒ½è§£é”ä¸‹ä¸€ä¸ªæˆå°± âœ¨';
    else stat.textContent = 'ğŸ‰ å·²è¾¾æˆå…¨éƒ¨æˆå°±ï¼';
  }

  function updateTotal(n){
    const ids = ['t50','t100','t200','t500'];
    const goals = [50,100,200,500];
    goals.forEach((g,i)=>{
      const b=document.getElementById(ids[i]);
      if(n>=g) b.classList.add('on'); else b.classList.remove('on');
    });
    const nextGoal = goals.find(g=> n<g);
    const pct = nextGoal? Math.min(100,(n/nextGoal)*100):100;
    const prog = document.getElementById('progT');
    prog.style.width = pct+'%';
    prog.textContent = n+' å°';
    const stat = document.getElementById('statT');
    if(nextGoal) stat.textContent = 'æˆ‘ä»¬ä¸€èµ·å†™äº† '+n+' å°å°å¿ƒå¿ƒå•¦ï¼Œå†æ¥ '+(nextGoal-n)+' å°å°±èƒ½è§£é”ä¸‹ä¸€ä¸ªæˆå°± âœ¨';
    else stat.textContent = 'ğŸ‰ æˆ‘ä»¬çš„æ‰€æœ‰æ€»æˆå°±éƒ½è¾¾æˆå•¦ï¼';
  }

  
  async function updateHotTags(){
    const stop = new Set(['çš„','äº†','å’Œ','ä¹Ÿ','åœ¨','æ˜¯','å°±','éƒ½','æˆ‘','ä½ ','ä»–','å¥¹','å®ƒ','æˆ‘ä»¬','ä½ ä»¬','ä»–ä»¬','ä¸€ä¸ª','è¿™ä¸ª','é‚£ä¸ª','å—','å§','å‘¢','å‘€','å“¦','å•Š','è®©','æŠŠ','å¾ˆ','è¿˜','åˆ','è¢«','ä¸','å¯¹','ç»™','åˆ°','äº','ä¸Š','ä¸‹','ä¸­','å»','æ¥','æ›´','æœ€','å¤š','å°‘','æ²¡','æœ‰','ä¼š','è¦','èƒ½','ä½†','è€Œ','å¦‚æœ','å› ä¸º','æ‰€ä»¥']);
    const tokenizeCN = (text) => {
      const arr = [];
      const s = (text||'').replace(/\s+/g,'');
      for(let i=0;i<s.length-1;i++){
        const w = s.slice(i,i+2);
        if(/[\u4e00-\u9fa5]{2}/.test(w) && !stop.has(w)) arr.push(w);
      }
      return arr;
    };
    const tokenizeEN = (text) => (text||'').toLowerCase().split(/[^a-z0-9#\+_]+/i).filter(x=>x && x.length>1 && !/^\d+$/.test(x));
    const extractTags = (text) => (text.match(/#([\p{Script=Han}a-zA-Z0-9_\-]{1,30})/gu)||[]).map(x=>x.replace(/^#/,''));

    const fetchIssueWithComments = async (issue) => {
      const base = `https://api.github.com/repos/${REPO}/issues/${issue}`;
      const metaR = await fetch(base);
      const meta = await metaR.json();
      const commentsR = await fetch(base + '/comments?per_page=100');
      const comments = await commentsR.json();
      const items = [];
      if(meta && (meta.title || meta.body)) items.push({body: (meta.title? meta.title+'\n':'') + (meta.body||'')});
      if(Array.isArray(comments)) comments.forEach(c => items.push({body: c.body||''}));
      return items;
    };

    try{
      const A = await fetchIssueWithComments(ISSUE_A);
      const F = await fetchIssueWithComments(ISSUE_F);
      const items = [...A, ...F];

      // Build frequencies
      const freq = new Map();
      const bump = (k, n=1)=> freq.set(k, (freq.get(k)||0)+n);
      items.forEach(it=>{
        const t = it.body || '';
        extractTags(t).forEach(tag=> bump('#'+tag, 3));     // hashtags weight higher
        tokenizeCN(t).forEach(w=> bump(w,1));
        tokenizeEN(t).forEach(w=> bump(w, w.startsWith('#')?2:1));
      });

      const pairs = [...freq.entries()].sort((a,b)=> b[1]-a[1]).slice(0,5);
      const box = document.getElementById('hotTags');
      box.innerHTML='';
      if(pairs.length===0){
        box.innerHTML = '<span class="note">æš‚æ—¶è¿˜æ²¡æœ‰çƒ­é—¨å°å¿ƒå¿ƒï½</span>';
        return;
      }
      pairs.forEach(([w,_],i)=>{
        const btn = document.createElement('button');
        btn.className='tag-btn';
        btn.style.animationDelay = (i*0.4)+'s';
        btn.textContent = w;
        btn.onclick = ()=>{
          document.getElementById('kwSearch').value = w;
          document.getElementById('kwBtn').click();
          // è‡ªåŠ¨æ»šåŠ¨åˆ°æœç´¢ç»“æœ
          document.getElementById('kwResults').scrollIntoView({behavior:'smooth', block:'center'});
        };
        box.appendChild(btn);
      });
    }catch(e){
      document.getElementById('hotTags').innerHTML='<span class="note">å°å¿ƒå¿ƒæ‹‰å–å¤±è´¥ï¼Œç¨åå†è¯•ï½</span>';
    }
  }


  loadCounts();
</script>
</body>
</html>
