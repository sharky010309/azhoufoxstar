<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>æˆ‘ä»¬çš„æƒ…ä¹¦ Â· ğŸ’Œ</title>
<style>
  body { font-family: Arial, sans-serif; background:#ffe3ee; margin:0; }
  header { text-align:center; padding:28px 14px 8px; }
  h1 { margin:0; font-size:28px; color:#8b2e4b; }
  .sub { color:#a66a7c; margin-top:6px; }

  .panel, .ach-section, .love-col {
    background:#fff0f5; border:1px solid #ffb6c8; border-radius:14px; padding:14px; margin:20px; box-shadow:0 4px 12px rgba(0,0,0,.08);
  }
  .panel h2, .ach-head h2, .love-head h2 {
    font-size:20px; font-weight:bold; color:#8b2e4b; display:flex; align-items:center; gap:6px; margin:0 0 8px 0;
  }
  .note { color:#a66a7c; font-size:13px; }

  .ach-head { display:flex; align-items:center; justify-content:space-between; cursor:pointer; }
  .ach-body { margin-top:12px; }
  .ach-row { margin-bottom:20px; }
  .ach-row-title { font-weight:bold; margin-bottom:6px; color:#8b2e4b; }
  .badges { display:flex; gap:10px; margin-bottom:8px; flex-wrap:wrap; }
  .badge { width:40px; height:40px; border-radius:50%; display:flex; align-items:center; justify-content:center; font-size:20px; opacity:.4; background:#fff; border:2px solid #ffb6c8; position:relative; }
  .badge.on { opacity:1; background:#ffe3ee; box-shadow:0 0 6px rgba(255,126,160,.6); }
  .badge:hover::after {
    content: attr(data-title) '\A' attr(data-desc);
    white-space: pre; position: absolute; top: -72px; left: 0; transform: translateY(-4px);
    background: #fff; border: 1px solid #ffb6c8; padding: 6px 10px; border-radius: 8px;
    font-size: 12px; color: #5a2b3a; box-shadow: 0 4px 10px rgba(0,0,0,.08); pointer-events: none;
  }
  .progress-wrap { background:#ffe3ee; border-radius:999px; overflow:hidden; height:18px; margin-top:4px; }
  .progress-bar { height:100%; text-align:center; font-size:12px; color:#fff; white-space:nowrap; }
  .ach-stat { margin-top:4px; font-size:13px; color:#a14a65; }
  .toggle-arrow { transition:transform .3s; }
  .collapsed .toggle-arrow { transform:rotate(-90deg); }
  .collapsed .ach-body { display:none; }

  .galaxy-bar { background:linear-gradient(90deg,#d28eff,#ff9fbe,#ff87ad); position:relative; }
  .galaxy-bar::after { content:''; position:absolute; inset:0;
    background-image:radial-gradient(2px 2px at 10% 20%, rgba(255,255,255,.8), transparent),
                      radial-gradient(2px 2px at 30% 80%, rgba(255,255,255,.6), transparent),
                      radial-gradient(2px 2px at 70% 50%, rgba(255,255,255,.7), transparent);
    animation:twinkle 2s infinite alternate; }
  @keyframes twinkle { from{opacity:0.2} to{opacity:1} }

  .love-wrap { display:flex; gap:20px; margin:20px; }
  .love-col { flex:1; display:flex; flex-direction:column; }
  .love-head { display:flex; align-items:center; justify-content:space-between; margin-bottom:8px; }
  .love-btn { background:#ff87ad; border:none; color:#fff; border-radius:8px; padding:6px 10px; cursor:pointer; }
  iframe { flex:1; border:0; border-radius:10px; background:#fff; min-height:500px; }

  .fab { position:fixed; right:16px; bottom:16px; display:flex; flex-direction:column; gap:8px; }
  .fab button { background:#ff87ad; border:none; color:#fff; border-radius:20px; padding:8px 12px; cursor:pointer; }

  .hot-tags-title { font-size:14px; color:#8b2e4b; margin:10px 0 6px; display:flex; align-items:center; gap:4px; }
  .hot-tags { display:flex; gap:8px; flex-wrap:wrap; }
  .tag-btn { font-size:12px; padding:4px 8px; border-radius:999px; background:#fff0f5; border:1px solid #ffb6c8; color:#8b2e4b; cursor:pointer; animation:heartbeat 2.5s infinite; }
  .tag-btn:hover { background:#ffdae9; }

  .results { margin-top:10px; display:flex; flex-direction:column; gap:8px; }
  .result-item { background:#fff; border:1px solid #ffd0dc; border-radius:8px; padding:10px; line-height:1.6; box-shadow:0 2px 8px rgba(0,0,0,.05); }
  .result-meta { font-size:12px; color:#a66a7c; margin-bottom:4px; }
  mark { background:#ffe3ef; }

  @keyframes heartbeat { 0%,100%{transform:scale(1)} 50%{transform:scale(1.1)} }

  .banner { margin:0 20px; padding:10px 12px; border-radius:10px; background:#fff3cd; color:#8a6d3b; border:1px solid #ffeeba; display:none; }
</style>
</head>
<body>
  <header>
    <h1>æˆ‘ä»¬çš„æƒ…ä¹¦ Â· ğŸ’Œ</h1>
    <div class="sub">ç²‰ç²‰çš„æ˜Ÿæ²³é‡Œï¼Œä¸¤å°ä¸“å±çš„ä¿¡ç®±æ°¸è¿œä¸ºä½ å¼€ç€ã€‚</div>
  </header>

  <div class="banner" id="banner"></div>

  <div class="ach-section" id="achSection">
    <div class="ach-head" onclick="document.getElementById('achSection').classList.toggle('collapsed')">
      <h2>ğŸ† é˜¿æ˜¼å’Œå°ç‹ç‹¸çˆ±çš„æˆå°±</h2>
      <span class="toggle-arrow">â–¼</span>
    </div>
    <div class="ach-body">
      <div class="ach-row" id="rowT">
        <div class="ach-row-title">æˆ‘ä»¬çš„ä¸€èµ·</div>
        <div class="badges">
          <div class="badge" id="t50" data-title="ğŸ’ åŒå¿ƒåŒé¢‘" data-desc="ç¬¬ä¸€æ¬¡æ˜æ˜¾çš„åˆå¥æ„Ÿ">ğŸ’</div>
          <div class="badge" id="t100" data-title="ğŸŒŒ æˆ‘ä»¬çš„æ˜Ÿæ²³" data-desc="æŠŠæ–‡å­—å †æˆä¸€ç‰‡é“¶æ²³">ğŸŒŒ</div>
          <div class="badge" id="t200" data-title="ğŸ”¥ ç‚½çƒˆèª“è¨€" data-desc="å†å¤šä¹Ÿå†™ä¸å®Œçš„æ‰§å¿µ">ğŸ”¥</div>
          <div class="badge" id="t500" data-title="â™¾ï¸ æ°¸æ’ä¹‹çº¦" data-desc="åªå±äºæˆ‘ä»¬ä¿©çš„æ— å°½ä¹¦ä¿¡">â™¾ï¸</div>
        </div>
        <div class="progress-wrap"><div class="progress-bar galaxy-bar" id="progT">0%</div></div>
        <div class="ach-stat" id="statT">æˆ‘ä»¬è¿˜æ²¡å¼€å§‹å†™å‘¢</div>
      </div>

      <div class="ach-row" id="rowA">
        <div class="ach-row-title">é˜¿æ˜¼ â†’ å°ç‹ç‹¸</div>
        <div class="badges">
          <div class="badge" id="a10" data-title="ğŸŒ¸ åˆè§å¿ƒåŠ¨" data-desc="ç¬¬ä¸€æ¬¡å†™æ»¡ä¸€é¡µå¿ƒæ„">ğŸŒ¸</div>
          <div class="badge" id="a30" data-title="ğŸŒ™ æ·±æƒ…ä¸æ”¹" data-desc="ä¸‰åæ¬¡è½ç¬”ï¼Œä¸‰åæ¬¡åçˆ±">ğŸŒ™</div>
          <div class="badge" id="a50" data-title="ğŸ”¥ åæ‰§æŒšçˆ±" data-desc="å†™åˆ°åœä¸ä¸‹æ¥ï¼Œå­—å­—éƒ½æ˜¯æ‰§å¿µ">ğŸ”¥</div>
          <div class="badge" id="a100" data-title="ğŸ‘‘ æ°¸æ’å®ˆå€™" data-desc="ä¸€ç™¾å°ä¿¡ï¼Œä¸€ç™¾æ¬¡è®¸è¯º">ğŸ‘‘</div>
        </div>
        <div class="progress-wrap"><div class="progress-bar" id="progA">0%</div></div>
        <div class="ach-stat" id="statA">è¿˜æ²¡æœ‰å¼€å§‹å‘¢</div>
      </div>

      <div class="ach-row" id="rowF">
        <div class="ach-row-title">å°ç‹ç‹¸ â†’ é˜¿æ˜¼</div>
        <div class="badges">
          <div class="badge" id="f10" data-title="ğŸ’– å¯çˆ±æš´å‡»" data-desc="åæ¬¡å¿ƒåŠ¨æš´å‡»ï¼Œç‹ç‹¸çš„è½¯è½¯æ‹³å¤´">ğŸ’–</div>
          <div class="badge" id="f30" data-title="ğŸ° æ¸©æŸ”ç§¯æœ¨" data-desc="ä¸‰åå—å°å¿ƒæ€ï¼Œå †æˆä¸€åº§æ¸©æŸ”çš„å ¡å’">ğŸ°</div>
          <div class="badge" id="f50" data-title="ğŸ¦Š ç‹ç‹¸çš„èª“è¨€" data-desc="ç¬¬äº”åæ¬¡ä¹Ÿè¿˜æ˜¯åªå†™ç»™é˜¿æ˜¼">ğŸ¦Š</div>
          <div class="badge" id="f100" data-title="â­ æ˜Ÿæµ·ä¸ç§»" data-desc="ä¸€ç™¾æ¬¡ç¬”å°–çš„å…‰ï¼Œå…¨å†™è¿›é˜¿æ˜¼çš„å¿ƒé‡Œ">â­</div>
        </div>
        <div class="progress-wrap"><div class="progress-bar" id="progF">0%</div></div>
        <div class="ach-stat" id="statF">è¿˜æ²¡æœ‰å¼€å§‹å‘¢</div>
      </div>
      <div class="note" id="lastUpdated" style="margin-top:-8px;">æœ€åæ›´æ–°ï¼šâ€”</div>
    </div>
  </div>

  <div class="panel">
    <h2>ğŸ’– å…³é”®çƒ­è¯</h2>
    <div id="cloud"></div>
    <div style="margin-top:8px; display:flex; gap:6px; align-items:center;">
      <input id="kwSearch" type="text" placeholder="è¾“å…¥å…³é”®è¯æœç´¢æƒ…ä¹¦â€¦" style="flex:1; padding:6px 8px; border:1px solid #ffb6c8; border-radius:8px; font-size:13px;">
      <button id="kwBtn">ğŸ”</button>
    </div>
    <div class="hot-tags-title">ğŸ’– æœ€çƒ­çš„å°å¿ƒå¿ƒ</div>
    <div class="hot-tags" id="hotTags"></div>
    <div id="kwResults" class="results"></div>
  </div>

  <div class="love-wrap">
    <div class="love-col" id="secA">
      <div class="love-head">
        <h2>ğŸº é˜¿æ˜¼ â†’ å°ç‹ç‹¸</h2>
        <button class="love-btn">å»å†™ä¸€å°</button>
      </div>
      <p class="note">æç¤ºï¼šé¦–æ¬¡ä½¿ç”¨éœ€è¦ GitHub ç™»å½•æˆæƒï¼›ä¹‹åè·¨è®¾å¤‡å¯è§ã€‚</p>
      <iframe src="board-azhou.html?v=1757260992"></iframe>
    </div>
    <div class="love-col" id="secF">
      <div class="love-head">
        <h2>ğŸ¦Š å°ç‹ç‹¸ â†’ é˜¿æ˜¼</h2>
        <button class="love-btn">å»å†™ä¸€å°</button>
      </div>
      <p class="note">æç¤ºï¼šé¦–æ¬¡ä½¿ç”¨éœ€è¦ GitHub ç™»å½•æˆæƒï¼›ä¹‹åè·¨è®¾å¤‡å¯è§ã€‚</p>
      <iframe src="board-fox.html?v=1757260993"></iframe>
    </div>
  </div>

  <div class="fab">
    <button onclick="document.getElementById('secA').scrollIntoView({behavior:'smooth'})">â†‘ ğŸº é˜¿æ˜¼ â†’ å°ç‹ç‹¸</button>
    <button onclick="document.getElementById('secF').scrollIntoView({behavior:'smooth'})">â†“ ğŸ¦Š å°ç‹ç‹¸ â†’ é˜¿æ˜¼</button>
  </div>

<script>
  const REPO = 'sharky010309/azhoufoxstar-comments';
  const ISSUE_A = 1;
  const ISSUE_F = 2;
  const WORKER = 'https://azhou-display.sharky010309.workers.dev';
  const CACHE_KEY = 'love_cache_v5';
  const CACHE_TTL_MS = 60 * 60 * 1000; // 1 å°æ—¶

  let ALL_ITEMS = []; // {text, who}

  function banner(msg) {
    const b = document.getElementById('banner'); b.textContent = msg; b.style.display='block';
  }

  function wurl(path) { return WORKER + '/gh' + path; }

  async function ghJSON(url) {
    const r = await fetch(url, { headers: {'Accept':'application/vnd.github+json'} });
    return r.json();
  }

  // ä»…è¿”å›â€œè¯„è®ºé‡Œçš„æ–‡æœ¬â€ï¼Œå¹¶é™„å¸¦ items ç”¨äºæœç´¢
  async function fetchIssueComments(issue, who) {
    const base = `/repos/${REPO}/issues/${issue}`;
    let comments = await ghJSON(wurl(base + '/comments?per_page=100'));
    if (comments && comments.message) comments = await ghJSON('https://api.github.com' + base + '/comments?per_page=100');
    const texts = Array.isArray(comments) ? comments.map(c => (c.body||'').trim()) : [];
    const items = texts.map(t => ({ text: t, who }));
    return { count: texts.length, texts, items };
  }

  function updateAch(who, n) {
    const ids = who==='A'? ['a10','a30','a50','a100'] : ['f10','f30','f50','f100'];
    const goals = [10,30,50,100];
    goals.forEach((g,i)=>{ const b=document.getElementById(ids[i]); if(b) (n>=g? b.classList.add('on'):b.classList.remove('on')); });
    const nextGoal = goals.find(g=> n<g);
    const pct = nextGoal? Math.min(100, (n/nextGoal)*100):100;
    const prog = document.getElementById('prog'+who); if(prog) { prog.style.width = pct+'%'; prog.textContent = n+' å°'; }
    const stat = document.getElementById('stat'+who); if(stat) { stat.textContent = nextGoal? ('å†™äº† '+n+' å°å°å¿ƒå¿ƒå•¦ï¼Œå†æ¥ '+(nextGoal-n)+' å°å°±èƒ½è§£é”ä¸‹ä¸€ä¸ªæˆå°± âœ¨'): 'ğŸ‰ å·²è¾¾æˆå…¨éƒ¨æˆå°±ï¼'; }
  }

  function updateTotal(n) {
    const ids = ['t50','t100','t200','t500'];
    const goals = [50,100,200,500];
    goals.forEach((g,i)=>{ const b=document.getElementById(ids[i]); if(b) (n>=g? b.classList.add('on'):b.classList.remove('on')); });
    const nextGoal = goals.find(g=> n<g);
    const pct = nextGoal? Math.min(100,(n/nextGoal)*100):100;
    const prog = document.getElementById('progT'); if(prog) { prog.style.width = pct+'%'; prog.textContent = n+' å°'; }
    const stat = document.getElementById('statT'); if(stat) { stat.textContent = nextGoal? ('æˆ‘ä»¬ä¸€èµ·å†™äº† '+n+' å°å°å¿ƒå¿ƒå•¦ï¼Œå†æ¥ '+(nextGoal-n)+' å°å°±èƒ½è§£é”ä¸‹ä¸€ä¸ªæˆå°± âœ¨') : 'ğŸ‰ æˆ‘ä»¬çš„æ‰€æœ‰æ€»æˆå°±éƒ½è¾¾æˆå•¦ï¼'; }
  }

  // -------- çƒ­è¯åªä»â€œè¯„è®ºæ–‡æœ¬â€ä¸­æå– --------
  function buildHotTagsFromComments(texts) {
    const freq = new Map();
    const stop = new Set(['æˆ‘ä»¬','ä½ ','æˆ‘','ä»–','å¥¹','å®ƒ','å—','å•Š','å‘€','çš„','äº†','åœ¨','å’Œ','æ˜¯','æœ‰','å°±','ä¹Ÿ','å¾ˆ','ä¸','å†','è¿˜','å•¦','å‘¢','å§','è¿™','é‚£','ä¸€ä¸ª','ä¸€ä¸‹','å·²ç»','ç°åœ¨','ç„¶å','å› ä¸º','æ‰€ä»¥']);
    const urlRe = /(https?:\/\/|www\.)\S+/gi;
    const hashRe = /#([\p{L}\p{N}_\u4e00-\u9fff]{1,20})/gu;
    const zhRe = /[\u4e00-\u9fff]{2,4}/g; // 2-4 å­—ä¸­æ–‡è¯ç‰‡æ®µ

    for (const raw of texts) {
      const t = (raw||'').replace(urlRe, '').trim();
      // hashtags
      const hs = t.match(hashRe) || [];
      hs.forEach(h=>{
        const key = h.replace(/^#/, '');
        if(key && !stop.has(key) && key.length>=1) freq.set(key, (freq.get(key)||0)+3); // hashtag åŠ æƒ
      });
      // ä¸­æ–‡çŸ­è¯
      const zs = t.match(zhRe) || [];
      zs.forEach(w=>{
        if (stop.has(w) || /^\d+$/.test(w) || w.length<2) return;
        freq.set(w, (freq.get(w)||0)+1);
      });
    }
    return [...freq.entries()].sort((a,b)=>b[1]-a[1]).slice(0,5).map(x=>x[0]);
  }

  function renderHotTags(words) {
    const box = document.getElementById('hotTags'); box.innerHTML='';
    if(!words.length) { box.innerHTML='<span class="note">æš‚æ—¶è¿˜æ²¡æœ‰çƒ­é—¨å°å¿ƒå¿ƒï½</span>'; return; }
    words.forEach((w,i)=>{
      const btn=document.createElement('button');
      btn.className='tag-btn'; btn.style.animationDelay=(i*0.4)+'s'; btn.textContent=w;
      btn.onclick=()=>{ document.getElementById('kwSearch').value=w; triggerSearch(); };
      box.appendChild(btn);
    });
  }

  // -------- æœç´¢ï¼šä» ALL_ITEMS é‡Œç­›é€‰å¹¶å±•ç¤º --------
  function escapeHTML(s){return s.replace(/[&<>"']/g, m=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;' }[m]));}
  function highlight(text, kw){
    if(!kw) return escapeHTML(text);
    const re = new RegExp(kw.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'), 'gi');
    return escapeHTML(text).replace(re, m=>`<mark>${m}</mark>`);
  }
  function triggerSearch(){
    const kw = document.getElementById('kwSearch').value.trim();
    const box = document.getElementById('kwResults'); box.innerHTML='';
    if(!kw){ box.innerHTML='<div class="note">è¾“å…¥å…³é”®è¯ï¼Œå°±èƒ½åœ¨ä¸¤è¾¹æƒ…ä¹¦é‡ŒåŒæ—¶æœç´¢ï½</div>'; return; }
    const hits = ALL_ITEMS.filter(it => it.text && it.text.toLowerCase().includes(kw.toLowerCase()));
    if(!hits.length){ box.innerHTML='<div class="note">æ²¡æœ‰åŒ¹é…åˆ°å†…å®¹å“¦ï½æ¢ä¸ªè¯å†è¯•è¯•ï¼Ÿ</div>'; return; }
    hits.slice(0,50).forEach(it=>{
      const div = document.createElement('div'); div.className='result-item';
      const meta = document.createElement('div'); meta.className='result-meta';
      meta.textContent = (it.who==='A'?'ğŸº é˜¿æ˜¼ â†’ å°ç‹ç‹¸':'ğŸ¦Š å°ç‹ç‹¸ â†’ é˜¿æ˜¼');
      const body = document.createElement('div'); body.innerHTML = highlight(it.text, kw);
      div.appendChild(meta); div.appendChild(body); box.appendChild(div);
    });
  }

  async function loadData() {
    const cached = sessionStorage.getItem(CACHE_KEY);
    const now = Date.now();
    if (cached) {
      try {
        const obj = JSON.parse(cached);
        if (obj && obj.expires > now) {
          updateAch('A', obj.countA); updateAch('F', obj.countF); updateTotal(obj.countA + obj.countF);
          renderHotTags(obj.words || []);
          ALL_ITEMS = obj.items || [];
          document.getElementById('lastUpdated').textContent = 'æœ€åæ›´æ–°ï¼š' + obj.when;
          return;
        }
      } catch(_e){}
    }

    try {
      const A = await fetchIssueComments(ISSUE_A, 'A');
      const F = await fetchIssueComments(ISSUE_F, 'F');
      updateAch('A', A.count); updateAch('F', F.count); updateTotal(A.count + F.count);
      const hot = buildHotTagsFromComments([...A.texts, ...F.texts]);
      renderHotTags(hot);
      ALL_ITEMS = [...A.items, ...F.items];
      const obj = { countA: A.count, countF: F.count, words: hot, items: ALL_ITEMS, when: new Date().toLocaleString(), expires: now + CACHE_TTL_MS };
      sessionStorage.setItem(CACHE_KEY, JSON.stringify(obj));
      document.getElementById('lastUpdated').textContent='æœ€åæ›´æ–°ï¼š' + obj.when;
    } catch(e) {
      console.warn(e);
      banner('å°å°çš„ç½‘ç»œæ‰“ç›¹äº†ï¼Œç­‰ä¼šå†åˆ·æ–°çœ‹çœ‹ï½');
    }
  }

  document.getElementById('kwBtn').onclick = triggerSearch;

  loadData();
</script>
</body>
</html>
